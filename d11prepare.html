<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome file</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html">
<h1 id="update-drupal-10.x---drupal-11.2">Update Drupal 10.x -&gt; Drupal 11.2</h1>
<p><a href="https://github.com/ubc-web-services/d11upgrade">repo here</a></p>
<h2 id="preparation-ddev-preferred">Prepare DDEV</h2>
<ol>
<li>Add ddev to the project <code>ddev config</code> (defaults are fine for projects without additional services like solr)</li>
<li>Run <code>composer install</code> to pull in current dependencies</li>
<li>Add the scripts in the <code>ddev-web-commands</code> directory to <code>.ddev/commands/web/</code></li>
<li>Start the site with <code>ddev start</code></li>
<li>Import the db with <code>ddev import-db &lt; [databasename]</code></li>
<li>Flush caches <code>ddev drush cr</code></li>
<li>Run script with <code>ddev d11prepare</code></li>
</ol>
<h2 id="script-operations">Script operations</h2>
<p>The script will first ask whether the site is based on a VPR, Science, APSC or other boilerplate. It then attempts to make the following updates</p>
<h3 id="modules-updated">Modules updated</h3>
<ul>
<li>Drush</li>
<li>Webform</li>
<li>Editor Advanced Link (only if in composer file, pinned to 2.3.1)</li>
<li>File Delete</li>
<li>CKEditor5 Fullscreen</li>
<li>Formtips (needs to straddle versions: ^1.11||^2.0)</li>
<li>Gin (needs to straddle versions: ^4.1||^5.0)</li>
<li>Gin Toolbar (needs to straddle versions: ^2.1||^3.0)</li>
<li>Image Widget Crop</li>
<li>Linkit (pinned to 7.0.10)</li>
<li>Linkit Media Library</li>
<li>UBC Portfolio modules (does not include CWL or custom modules)</li>
<li>UBC Recipes</li>
</ul>
<h3 id="additional-updates">Additional updates</h3>
<ul>
<li>Add and install the Upgrade Status module (if needed)</li>
<li>Update the core version requirement to VPR and Science portfolio child themes</li>
<li>Prompt you to add the core version requirement if you’re using a custom theme</li>
<li>alter the recipe location to the root directory</li>
<li>alter the .gitignore to remove /web/recipes/ and add /recipes/</li>
<li>delete the old recipes stored in /web/recipes from the local project</li>
</ul>
<h3 id="cleanup">Cleanup</h3>
<ul>
<li>The following files will be deleted:
<ul>
<li>.lando</li>
<li>landoquickstart.sh</li>
<li>LICENSE</li>
<li>project_summary.md (if present)</li>
<li>simplessamlphp directory (conditional - only if cwl modules are not in composer)</li>
</ul>
</li>
<li>If cypress is the only node package in the root package.json:
<ul>
<li>/cypress (directory and contents)</li>
<li>cypress.json</li>
<li>package.json</li>
<li>package-lock.json</li>
</ul>
</li>
<li>Make sure to commit any changes (ie. ddev, .gitignore, composer) once you are ready to proceed</li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<ol>
<li>Review and resolve the issues on the Upgrade Status page</li>
</ol>
<ul>
<li>/admin/reports/upgrade-status</li>
<li>Note that formtips will show as having an <em>Incompatible</em> local version, but that can be disregarded since we are straddling required versions. The updated version will be pulled in when core is updated.</li>
</ul>
<ol start="2">
<li>Backup work</li>
</ol>
<ul>
<li>Run database updates to ensure the latest changes are in place.<br>
<code>ddev drush updb</code> OR <code>lando drush updb</code></li>
<li>Export database in case you want to roll back.<br>
<code>ddev export-db --file=db.sql.gz</code> OR <code>ddev snapshot</code> OR <code>lando db-export</code></li>
</ul>
<ol start="3">
<li>Run Update: also see <a href="https://www.drupal.org/docs/upgrading-drupal/upgrading-from-drupal-8-or-later/how-to-upgrade-from-drupal-10-to-drupal-11">Official Docs</a></li>
</ol>
<ul>
<li>Update permissions.</li>
</ul>
<pre><code>chmod 777 web/sites/default
chmod 666 web/sites/default/*settings.php
chmod 666 web/sites/default/*services.yml

</code></pre>
<ul>
<li>Change core without updating.</li>
</ul>
<pre><code>composer require 'drupal/core-recommended:^11' \
'drupal/core-composer-scaffold:^11' \
'drupal/core-project-message:^11' --no-update

</code></pre>
<ul>
<li>Perform the update dry-run<br>
<code>composer update --dry-run</code></li>
<li>If no errors, perform the update<br>
<code>composer update</code></li>
<li>Run database updates again.<br>
<code>ddev drush updb</code> OR <code>lando drush updb</code></li>
<li>Reinstate permissions (optional on local)</li>
</ul>
<pre><code>chmod 777 web/sites/default
chmod 666 web/sites/default/*settings.php
chmod 666 web/sites/default/*services.yml

</code></pre>
<ol start="4">
<li>Update DDEV recipe</li>
</ol>
<ul>
<li><code>ddev config</code> and choose Drupal11 recipe</li>
</ul>
<ol start="5">
<li>Commit all changes</li>
</ol>
</div>
</body>

</html>
